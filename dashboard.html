<button onclick="deleteProfile()" style="margin-top:10px; background:#990000; color:#fff;">
  Delete Profile
</button>

<script type="module">
import { supabase } from "./supabaseClient.js";

async function deleteProfile() {
  if (!confirm("Are you sure you want to delete your profile? This cannot be undone.")) return;

  try {
    const user = supabase.auth.user();
    if (!user) throw new Error("No user logged in");

    // Delete the profile row
    const { error: profileError } = await supabase
      .from("profiles")
      .delete()
      .eq("id", user.id);
    if (profileError) throw profileError;

    // Delete the auth account
    const { error: authError } = await supabase.auth.admin.deleteUser(user.id);
    if (authError) throw authError;

    alert("Profile deleted successfully.");
    window.location.href = "index.html"; // redirect to signup/login page
  } catch (err) {
    console.error("Error deleting profile:", err);
    alert(err.message || "Failed to delete profile");
  }
}

window.deleteProfile = deleteProfile;
  </script>
